(self.webpackChunkbello=self.webpackChunkbello||[]).push([[433],{21304:function(Ve,J,c){"use strict";c.r(J),c.d(J,{default:function(){return be}});var f=c(67294),re=c(97857),h=c.n(re),ue=c(13769),R=c.n(ue),A=c(71230),j=c(15746),I=c(48413),D=c(96486),P={REMOVE:{code:"REMOVE",color:"#ff4d4f",text:"\u5220\u9664"},ADD:{code:"ADD",color:"#52c41a",text:"\u65B0\u589E"},MODIFY:{code:"MODIFY",color:"#faad14",text:"\u4FEE\u6539"},EMPTY:{code:"EMPTY",color:"#d9d9d9",text:"\u7A7A"}},N=function(s){return s.SOURCE="_DIFORM_TYPE_SOURCE_",s.TARGET="_DIFORM_TYPE_TARGET_",s}({});function E(s){return typeof s=="undefined"||s===null||s===""}function T(s,n){return E(s)&&E(n)?!0:(0,D.isEqual)(s,n)}var ae=function(n,e,t){if(E(n)&&!E(e))return t===N.SOURCE?P.EMPTY:P.REMOVE;if(!E(n)&&E(e))return t===N.SOURCE?P.REMOVE:P.ADD;if(!T(n,e))return P.MODIFY},a=c(85893),b=(0,f.createContext)({}),Z=function(n){var e=n.children,t=n.value,r=(0,f.useContext)(b),u=(0,f.useMemo)(function(){return Object.assign({},r,t)},[t,r]);return(0,a.jsx)(b.Provider,{value:u,children:e})},V=(0,f.createContext)({}),g=function(n){var e=n.children,t=n.value,r=(0,f.useContext)(V),u=(0,f.useMemo)(function(){return Object.assign({},r,t)},[t,r]);return(0,a.jsx)(V.Provider,{value:u,children:e})},ke=c(84820),ie=c(96695),oe=c.n(ie),se=c(19632),F=c.n(se),le=c(12444),fe=c.n(le),ce=c(72004),de=c.n(ce),ve=c(9783),k=c.n(ve),O=function(){function s(){fe()(this,s),k()(this,"state",{}),k()(this,"subscribers",[])}return de()(s,[{key:"setState",value:function(e){s.updateState(this.state,e)}},{key:"getSnapshots",value:function(){return this.state}},{key:"getSnapshot",value:function(e){var t=e.names,r=e.type;if(t&&r)return this.state[[r].concat(F()(t)).join(s.keySplit)]}},{key:"getUniqueFieldsSnapshots",value:function(e){var t=e.names,r=e.type,u=e.uniqueKey;if(t&&r&&u)return(0,D.pickBy)(this.state,function(o,i){return new RegExp("^".concat(s.join([s.join([r].concat(F()(t))),"\\d",s.join(u)]),"$")).test(i)})}},{key:"getChildSnapshots",value:function(e){var t=e.names,r=e.type;if(t&&r){var u=s.join([r].concat(F()(t)));return(0,D.pickBy)(this.state,function(o,i){return i.startsWith(u)})}}},{key:"emit",value:function(e){var t=s.join([e.type].concat(F()(e.names))),r=this.state[t];this.setState(e);var u=oe()(this.subscribers),o;try{for(u.s();!(o=u.n()).done;){var i=o.value;i.onlyValue&&!e.remove&&r&&T(e.value,r.value)||(i.fuzzy&&t.startsWith(i.key)||i.uniqueKey&&new RegExp("^".concat(s.join([(0,D.escapeRegExp)(i.key),"\\d",(0,D.escapeRegExp)(s.join(i.uniqueKey))]),"$")).test(t)||t===i.key)&&i.callback(e)}}catch(l){u.e(l)}finally{u.f()}}},{key:"on",value:function(e,t){var r=this,u=[t.type].concat(F()(t.names)).join(s.keySplit),o=h()(h()({},t),{},{key:u,callback:e});return this.subscribers.push(o),function(){var i=r.subscribers.indexOf(o);i>-1&&r.subscribers.splice(i,1)}}}],[{key:"join",value:function(e){return e.join(s.keySplit)}},{key:"updateState",value:function(e,t){var r=[t.type].concat(F()(t.names)).join(s.keySplit);return t.remove?delete e[r]:e[r]=t,e}}]),s}();k()(O,"keySplit","_DIFORM_STORE_KEY_SPLIT_");var y=function(){return(0,f.useContext)(b)},q=function(){var n=y(),e=n.type;return e===N.SOURCE?N.TARGET:N.SOURCE},me=function(n){var e=(0,f.useRef)(n);return e.current=n,(0,f.useCallback)(function(){return e.current.apply(e,arguments)},[])},he=function(n){var e=(0,f.useRef)(),t=(0,f.useRef)(n);return t.current!==n&&(e.current=t.current,t.current=n),e.current},z=function(n,e){var t=(0,f.useRef)(),r=he(e);return(typeof e=="undefined"||!(0,D.isEqual)(r,e))&&(t.current=n()),t.current},Y=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var r=e[0],u=e.slice(1),o=me(r);return z(function(){return D.debounce.apply(void 0,[o].concat(F()(u)))},[u])},L=function(){return(0,f.useContext)(V)},U=function(n){return z(function(){if(typeof n!="undefined")return Array.isArray(n)?n.length?n:void 0:[n]},[n])},xe=c(5574),B=c.n(xe),M=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return z(function(){if(!e.some(function(u){return typeof u=="undefined"})){var r=D.concat.apply(void 0,e);return r.length?r:void 0}},[e])},ye=function(n){var e=U(n),t=y(),r=t.fullNamePath;return M(r,e)},Q=function(n){var e=U(n),t=y(),r=t.anotherFieldName,u=t.uniqueKey;return(0,f.useMemo)(function(){return u&&typeof r=="number"&&typeof(e==null?void 0:e[0])=="number"?[r].concat(F()(e.slice(1))):e},[r,e,u])},W=function(n,e){var t=y(),r=t.store,u=(0,f.useState)(function(){return r==null?void 0:r.getSnapshot({type:n,names:e})}),o=B()(u,2),i=o[0],l=o[1],m=Y(function(d){l(d)},300);return(0,f.useEffect)(function(){if(e&&n&&r){m(r.getSnapshot({type:n,names:e}));var d=r.on(function(v){m(v.remove?void 0:v)},{names:e,type:n,onlyValue:!0});return function(){d(),m.cancel()}}},[n,e,r,m]),i},qe=function(n){var e=useDiformContext(),t=e.type,r=useNextNames(n);return W(t,r)},je=function(n){var e=y(),t=e.anotherFullNamePath,r=q(),u=Q(n),o=M(t,u);return W(r,o)},Ce=function(n){var e=y(),t=e.type,r=e.fullNamePath,u=e.uniqueKey,o=M(r,n,u);return W(t,o)},Se=function(){var n=y(),e=n.store,t=n.anotherFullNamePath,r=n.uniqueKey,u=q(),o=(0,f.useState)(function(){return e==null?void 0:e.getUniqueFieldsSnapshots({names:t,type:u,uniqueKey:r})}),i=B()(o,2),l=i[0],m=i[1],d=(0,f.useRef)(l),v=Y(function(){m(d.current)},300);return(0,f.useEffect)(function(){if(t&&u&&e&&r){d.current=e.getUniqueFieldsSnapshots({names:t,type:u,uniqueKey:r}),v();var C=e.on(function(S){d.current=d.current?O.updateState(h()({},d.current),S):e==null?void 0:e.getUniqueFieldsSnapshots({names:t,type:u,uniqueKey:r}),v()},{names:t,type:u,uniqueKey:r,onlyValue:!0});return function(){C(),v.cancel()}}},[t,v,e,u,r]),l},De=function(n){var e=y(),t=e.store,r=e.anotherFullNamePath,u=M(r,n),o=q(),i=(0,f.useRef)((0,f.useMemo)(function(){return t==null?void 0:t.getChildSnapshots({names:u,type:o})},[])),l=(0,f.useState)(!(0,D.isEmpty)(i.current)),m=B()(l,2),d=m[0],v=m[1],C=Y(function(){v(!(0,D.isEmpty)(i.current))},300);return(0,f.useEffect)(function(){if(u&&o&&t){i.current=t.getChildSnapshots({type:o,names:u}),C();var S=t.on(function(G){i.current=i.current?O.updateState(h()({},i.current),G):t==null?void 0:t.getChildSnapshots({names:u,type:o}),C()},{names:u,type:o,onlyValue:!0,fuzzy:!0});return function(){S(),C.cancel()}}},[o,u,t,C]),d},Ie=function(n){var e=y(),t=e.uniqueKey,r=e.anotherFullNamePath,u=Se(),o=Ce(n),i=De(n);return(0,f.useMemo)(function(){if(t&&u&&o&&r){var l;return(l=(0,D.values)(u).find(function(m){return T(m.value,o.value)}))===null||l===void 0?void 0:l.names[r.length]}return i?n:void 0},[t,u,o,r,i,n])},pe=c(94184),Ne=c.n(pe),X=function(n){var e=n.className,t=n.style,r=n.children,u=y(),o=u.statusInfo,i=u.firstStatus,l=i?o:null;return(0,a.jsxs)("div",{className:Ne()(e,{"bello-diform-mark":l}),style:h()({borderColor:l==null?void 0:l.color},t),children:[l?(0,a.jsxs)("div",{className:"bello-diform-mark-divider",children:[(0,a.jsx)("span",{style:{borderColor:l.color}}),(0,a.jsx)("span",{style:{color:l.color},children:o==null?void 0:o.text}),(0,a.jsx)("span",{style:{borderColor:l.color}})]}):null,r]})},Fe=["children","name"],Pe=["children"],ge=function(n){var e=n.children,t=n.name,r=R()(n,Fe),u=y(),o=u.type,i=u.store,l=u.statusInfo,m=u.firstStatus,d=je(t),v=ye(t),C=(0,f.useRef)(i);C.current=i;var S=(0,f.useMemo)(function(){if(o){var p=r.value,H=d==null?void 0:d.value;return ae(p,H,o)}},[d==null?void 0:d.value,r.value,o]),G=(0,f.useMemo)(function(){return{statusInfo:S!=null?S:l,firstStatus:!m&&!l&&!!S}},[m,S,l]);return(0,f.useEffect)(function(){if(v&&o){var p,H=r.value;(p=C.current)===null||p===void 0||p.emit({type:o,names:v,value:H,statusInfo:S})}},[r.value,v,S,o]),(0,f.useEffect)(function(){if(o&&v)return function(){var p;return(p=C.current)===null||p===void 0?void 0:p.emit({type:o,names:v,remove:!0})}},[v,o]),(0,a.jsx)(Z,{value:G,children:(0,a.jsx)(X,{children:(0,f.cloneElement)(e,r)})})},Ee=function(n){var e=n.children,t=R()(n,Pe),r=y(),u=U(n.name);return typeof r.type!="undefined"&&u&&(0,f.isValidElement)(e)?(0,a.jsx)(I.Z.Item,h()(h()({},t),{},{children:(0,a.jsx)(ge,{name:t.name,children:e})})):(0,a.jsx)(I.Z.Item,h()(h()({},t),{},{children:e}))},Ze=["uniqueKey"],Me=["uniqueKey"],Re=function(n){var e=n.uniqueKey,t=R()(n,Ze),r=y(),u=r.anotherFullNamePath,o=L(),i=o.namePaths,l=Q(t.name),m=M(u,l),d=U(e),v=(0,f.useMemo)(function(){return{fullNamePath:i,anotherFullNamePath:m,uniqueKey:d}},[i,m,d]);return(0,a.jsx)(Z,{value:v,children:(0,a.jsx)(I.Z.List,h()({},t))})},Ae=function(n){var e=n.uniqueKey,t=R()(n,Me),r=y(),u=L(),o=u.namePaths,i=M(o,n.name),l=(0,f.useMemo)(function(){return{namePaths:i}},[i]);return typeof r.type!="undefined"?(0,a.jsx)(g,{value:l,children:(0,a.jsx)(Re,h()(h()({},t),{},{uniqueKey:e}))}):(0,a.jsx)(g,{value:l,children:(0,a.jsx)(I.Z.List,h()({},t))})},Ke=function(n){var e=n.children,t=L(),r=t.fieldName,u=Ie(r),o=y(),i=o.statusInfo,l=o.type,m=o.firstStatus,d=(0,f.useMemo)(function(){if(i)return i;if(typeof u!="number")return l===N.SOURCE?P.REMOVE:P.ADD},[u,i,l]),v=(0,f.useMemo)(function(){return{fieldName:r,anotherFieldName:u,statusInfo:d,firstStatus:!m&&!i&&!!d}},[r,m,u,d,i]);return(0,a.jsx)(Z,{value:v,children:(0,a.jsx)(X,{children:e})})},Oe=function(n){var e=y(),t=(0,f.useMemo)(function(){return{fieldName:n.fieldName}},[n.fieldName]);return typeof e.type!="undefined"?(0,a.jsx)(g,{value:t,children:(0,a.jsx)(Ke,h()({},n))}):(0,a.jsx)(g,{value:t,children:n.children})},Le=["diff"],x=function(n){var e=n.diff,t=R()(n,Le),r=(0,f.useMemo)(function(){var v={layout:t.layout,name:"source"};if(e===!0)return v;if(e)return h()(h()({},v),e)},[e,t.layout]),u=(0,f.useMemo)(function(){return h()({name:r?"target":void 0},t)},[t,r]),o=(0,f.useMemo)(function(){return{store:new O,fullNamePath:[],anotherFullNamePath:[]}},[]),i=(0,f.useMemo)(function(){return{type:N.SOURCE}},[]),l=(0,f.useMemo)(function(){return{type:N.TARGET}},[]),m=(0,f.useMemo)(function(){return{name:r==null?void 0:r.name,disabled:r==null?void 0:r.disabled,namePaths:[]}},[r==null?void 0:r.disabled,r==null?void 0:r.name]),d=(0,f.useMemo)(function(){return{name:u==null?void 0:u.name,disabled:u==null?void 0:u.disabled,namePaths:[]}},[u==null?void 0:u.disabled,u==null?void 0:u.name]);return r?(0,a.jsx)(Z,{value:o,children:(0,a.jsxs)(A.Z,{gutter:8,children:[(0,a.jsx)(j.Z,{span:12,children:(0,a.jsx)(g,{value:m,children:(0,a.jsx)(Z,{value:i,children:(0,a.jsx)(I.Z,h()(h()({},r),{},{children:u.children}))})})}),(0,a.jsx)(j.Z,{span:12,children:(0,a.jsx)(g,{value:d,children:(0,a.jsx)(Z,{value:l,children:(0,a.jsx)(I.Z,h()({},u))})})})]})}):(0,a.jsx)(g,{value:d,children:(0,a.jsx)(I.Z,h()({},u))})};x.Item=Ee,x.List=Ae,x.ListItem=Oe,x.useForm=I.Z.useForm,x.useFormInstance=I.Z.useFormInstance,x.useWatch=I.Z.useWatch,x.useDiformInfo=L;var $=c(90837),K=c(56881),w=c(18404),_=c(17211),ee=c(49191),te=c(79855),ne=c(24193),Ue=function(){var n=x.useDiformInfo(),e=n.fieldName;return(0,a.jsx)($.Z,{title:"\u5BB6\u957F",size:"small",children:(0,a.jsx)(x.List,{name:[e,"parents"],children:function(r,u){var o=u.add,i=u.remove;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(A.Z,{gutter:[0,16],children:[r.map(function(l){return(0,a.jsx)(j.Z,{span:24,children:(0,a.jsx)(x.ListItem,{fieldName:l.name,children:(0,a.jsxs)(A.Z,{gutter:8,align:"middle",children:[(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[l.name,"name"],label:"\u59D3\u540D",rules:[{required:!0,message:"\u5FC5\u586B\u9879"}],children:(0,a.jsx)(K.Z,{})})}),(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[l.name,"relation"],label:"\u5173\u7CFB",children:(0,a.jsx)(K.Z,{})})}),(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[l.name,"height"],label:"\u624B\u673A\u53F7",children:(0,a.jsx)(K.Z,{})})}),(0,a.jsx)(j.Z,{children:(0,a.jsx)(w.Z.Link,{type:"danger",onClick:function(){return i(l.name)},children:(0,a.jsx)(te.Z,{})})})]})})},l.key)}),(0,a.jsx)(j.Z,{span:24,children:(0,a.jsx)(_.ZP,{block:!0,icon:(0,a.jsx)(ne.Z,{}),onClick:function(){return o()},children:"\u6DFB\u52A0\u5BB6\u957F"})})]})})}})})},Te=function(){var n=x.useFormInstance();return(0,a.jsx)($.Z,{title:"\u5B66\u751F\u540D\u5355",size:"small",children:(0,a.jsx)(x.List,{name:"students",uniqueKey:"name",children:function(t,r){var u=r.add,o=r.remove;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(A.Z,{gutter:[0,16],children:[t.map(function(i){return(0,a.jsx)(j.Z,{span:24,children:(0,a.jsxs)(x.ListItem,{fieldName:i.name,children:[(0,a.jsxs)(A.Z,{gutter:8,align:"middle",children:[(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[i.name,"name"],label:"\u59D3\u540D",rules:[{required:!0,message:"\u5FC5\u586B\u9879"},{validator:function(m,d){var v=n.getFieldValue(["students"])||[];return v.some(function(C,S){return S!==i.name&&(C==null?void 0:C.name)===d})?Promise.reject(new Error("\u59D3\u540D\u91CD\u590D")):Promise.resolve()}}],children:(0,a.jsx)(K.Z,{})})}),(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[i.name,"age"],label:"\u5E74\u9F84",children:(0,a.jsx)(ee.Z,{style:{width:"100%"}})})}),(0,a.jsx)(j.Z,{span:7,children:(0,a.jsx)(x.Item,{name:[i.name,"height"],label:"\u8EAB\u9AD8",children:(0,a.jsx)(ee.Z,{style:{width:"100%"},addonAfter:"cm"})})}),(0,a.jsx)(j.Z,{children:(0,a.jsx)(w.Z.Link,{type:"danger",onClick:function(){return o(i.name)},children:(0,a.jsx)(te.Z,{})})})]}),(0,a.jsx)(Ue,{})]})},i.key)}),(0,a.jsx)(j.Z,{span:24,children:(0,a.jsx)(_.ZP,{block:!0,icon:(0,a.jsx)(ne.Z,{}),onClick:function(){return u()},children:"\u6DFB\u52A0\u5B66\u751F"})})]})})}})})},be=function(){return(0,a.jsxs)(x,{diff:!0,layout:"vertical",children:[(0,a.jsx)(x.Item,{name:"clazz",label:"\u73ED\u7EA7",rules:[{required:!0}],children:(0,a.jsx)(K.Z,{})}),(0,a.jsx)(Te,{})]})}},84820:function(){}}]);
